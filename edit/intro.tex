\section{Introdução}

Este trabalho foi desenvolvindo para implementar um servidor RADIUS em conjunto com uma
base de dados LDAP para prover um serviço de autenticação de usuário a uma rede.
As seções seguintes abordam a definição do problema, ou seja, a motivação da implementação
desenvolvimento feito até a finalização do trabalho, dificuldades encontradas durante o
de um servidor RADIUS e LDAP, a solução encontrada para a implementação do protocolo, o
desenvolvimento e os resultados encontrados.

Como foi visto em sala de aula, apesar de uma encriptação de chave compartilhada
ser melhor que não ter encriptação alguma, algumas falhas de segurança podem ser
observadas.


\subsection{O Problema}

Em um contexto de uma empresa, a distribuição de internet por Wireless é um ponto de
vulnerabilidade para a rede local. Na maior parte dos casos, uma rede Wifi é protegida
utilizando o protocolo WPA2 Pre-Shared Key (PSK), que consiste na proteção do acesso a internet com uma
chave secreta compartilhada. Isso significa que todos os usuários daquela rede terão acesso
sua conexão criptografada com a mesma chave, que não pode ser revogada. \cite{freeradius}

Especialmente num ambiente corporativo, onde se tem alta rotatividade de pessoas,
o PSK não é o modelo mais seguro de conexão com a internet. Um usuário que não tem
mais vínculo com a empresa não deveria ter mais acesso à rede e o único jeito de se
fazer isto com o PSK é mudando a chave de acesso, que causa um grande \textit{overhead}
para os usuários e não garante muito mais segurança, já que um atacante pode realizar
ataques offline para descobrir a chave \cite{freeradius}

Para resolver este problema, a IEEE, ao descrever os padrões para internet sem fio,
previu um modelo "Empresarial" que difere do PSK no sentido de usar autenticação
por usuário e por sessão \cite{freeradius}. Este modelo também permite revogação de
acesso e a separação dos usuários por grupos (criando diferente VLANs, por exemplo). \cite{freeradius}

No contexto da disciplina, foi implementado a autenticação empresarial no LAPPIS,
um laboratório de desenvolvimento de software da FGA, que enfrenta alguns dos
problemas citados anteriormente.

\section{Radius}

O protocolo \textit{Remote Authentication Dial-in User Service} (RADIUS) foi desenvolvido pela
Livingston Enterprises Inc. como um servidor de acesso e autenticação. RADIUS é um
protocolo cliente/servidor \cite{radius-guide}.


O servidor Radius é uma parte importante da implementação do padrão empresarial
de Wi-Fi do IEEE. Nele são realizados os processos que cuidarão do AAA, que significa
\textit{Authentication, Authorization and Accounting}. Esses serviços são essenciais
para o pleno funcionamento do \textit{WPA Enterprise}, já que uma rede que não implementa
nenhum dos três é considerada insegura e "aberta", onde "qualquer um pode ganhar
acesso e fazer o que quiser, sem ser rastreado" \cite{radius-guide}.

\subsection{Autenticação (\textit{Authentication})}

Autenticação é o serviço de validação da identidade do usuário, ou seja, comparação
das credenciais fornecidas, com as armazenadas no banco de dados. Se essas informações
são iguais, o acesso à rede é garantido, caso contrário, é negado. Se o usuário for
bloqueado ou banido, também ocorre falha na autenticação. \cite{radius-guide}


\subsection{Autorização (\textit{Authorization})}

Autorização é o processo de determinar o que o usuário pode fazer \cite{radius-guide}. Após a
autenticação, verifica-se então qual o acesso que aquele usuário tem na rede. Bloquear
algum tipo de site (um domínio ou conjunto de domínios específicos) é um exemplo
de autorização.

Com base nas informações que foram mandadas pelo cliente, e na fase anterior, o Radius
envia de volta para o cliente o que aquele usuário pode fazer na rede. O cliente,
por sua vez, é responsável por aplicar essas restrições. \cite{radius-guide}

\subsection{Responsabilidade (\textit{Accounting})}

O processo de responsabilidade (tradução livre) é onde se armazena dados relativos
ao uso da rede por determinado usuário. Esses podem ser "tempo de utilização do sistema,
quantidade de dados enviada ou recebida durante uma sessão" \cite{radius-guide}, por exemplo.

As informações armazenados neste processo não incluem informações detalhadas sobre o tráfego
de dados da rede, como por exemplo quantidade de bytes transferida numa requisição HTTP \cite{radius-guide}

\subsection{Processo da Sessão Radius}

O processo da sessão radius consiste em vários passos \cite{radius-guide}, descritos a seguir:
\begin{itemize}
    \item Um usuário entra em contato com o cliente Radius (NAS, geralmente) para
    acessar a rede;
    \item O NAS entra em contato com o servidor Radius, usando o mecanismo \textit{shared secret},
    na porta certa para o serviço;
    \item O NAS manda um \textit{Access-Request} ao servidor, com as credenciais
    do usuário;
        \subitem A mensagem é mandada utilizando um dos protocolos de segurança:
        EAP \textit{(Extensible Authentication Protocol)},
        CHAP \textit{(Challenge-Handshake Authentication Protocol)} ou
        PAP \textit{(Password Authentication Protocol)}
    \item O servidor Radius autentica o usuário;
    \item O servidor Radius manda o resultado de volta para o NAS. Se o usuário foi
    corretamente autenticado, o NAS receberá um \textit{Access Accept} e as políticas
    de uso para aquele usuário. Se o usuário foi rejeitado, um \textit{Access Reject}
    será enviado, e o usuário não terá acesso à rede.
\end{itemize}

É importante ressaltar que o servidor Radius, apesar de conter as informações e políticas
do usuário NÃO é o responsável por aplicá-las. Na verdade, toda a comunicação se dá por
iniciativa do cliente e o cliente é quem deve fazer cumprir todas as políticas para aquele usuário.

\section{LDAP}

O \textit{Lightweight Directory Access Protocol} (LDAP) é um protocolo para acessar
serviços de diretório, que são banco de dados (não relacionais) "especialmente
projetados para pesquisa e navegação, com suporte básico à funções de consulta e
atualização" (tradução livre) \cite{openldap}

O LDAP serve para diversos usos, como autenticação de máquina, autenticação de usuários,
representação organizacional, lista de endereços, entre vários outros. Ele utiliza
um modelo cliente/servidor, onde o servidor contém a informação desejada. O cliente
pergunta onde está aquela informação e o servidor responde com um ponteiro para ela.\cite{openldap}

A informação é armazenada em formato de árvore hierárquica, que, geralmente, reflete
a organização da empresa. Cada "nó" da árvore é uma entrada e pode ter um tipo e vários
valores, além de "redirecionar" o usuário para outros nós. Cada nó é identificado
por um \textit{Distinguished Name} (dn), que é formado através do nome do nó concatenado
aos nós superiores.\cite{openldap}


\section{Solução e Desenvolvimento}

A solução do problema do LAPPIS consiste em instanciar o \textit{WPA Enterprise}
com os seguintes elementos:

\begin{itemize}
    \item servidor Radius
    \item configuração do cliente Radius, NAS ("roteador" do LAPPIS)
    \item servidor LDAP
    \item integração Radius e LDAP
    \item interface para criação/desativação de usuários
\end{itemize}

\section{Dificuldades}

O grupo teve dificuldades, no primeiro momento, em "subir" o servidor Radius,
dado que vários dos tutoriais da internet são ultrapassados. Por causa disso,
a autenticação não funcionava corretamente e o serviço estava muito lento.
Um novo tutorial foi encontrado e o grupo percebeu que as configurações que
vinham na instalação dos pacotes já fazia com que o Radius funcionasse corretamente
\textit{out-of-the-box}.

Após isso, "levantar" o servidor LDAP também foi complicado, devido a pouca
experiência que os integrantes do grupo tinham.


Integrar os dois serviços foi a parte mais desafiadora do trabalho. O grupo procurou
vários tutoriais e não teve sucesso com nenhum, por causa de instruções errôneas,
versões desatualizadas de pacotes, etc. Foi decidido, então, tentar uma abordagem
"manual" (tentativa e erro).

\section{Passos para a configuração do servidor}

\subsection{Radius}
Para configurar o servidor radius, foi utilizada uma VM \verb|CentOS 7|. As seguintes
configurações foram testadas também numa máquina rodando \verb|Antergos| (uma distribuição
com kernel do Arch Linux). 

Instale a versão 3.0.4 (vem empacotada em 5/12/16):
\begin{verbatim}
# yum install -y freeradius freeradius-ldap
\end{verbatim}

Edite o arquivo \verb|/etc/raddb/clients.conf|, adicionando os clientes ou as sub-redes,
assim como a senha para comunicação com este servidor. O seguinte exemplo pode ser modificado
para atender suas necessidades, qualquer dos valores pode ser alterado.

\begin{verbatim}
client lappis {
    secret = testing123
    ipaddr = 192.168.0.1
    nastype = other
}
\end{verbatim}

Descomente e edite as seguintes entradas no seu arquivo \verb|/etc/raddb/mods-available/ldap|.
Cada um dos valores deve se referir a sua instalação do ldap. Deixe TODAS as outras
entradas como estão, e só edite-as se REALMENTE souber o que está fazendo.:

\begin{verbatim}
ldap {
    server = "localhost"
    port = 389

    base_dn = "dc=example,dc=com"

    identity = "cn=admin,dc=example,dc=com"
    password = admin

    ...
}
\end{verbatim}

Se esse arquivo não existir, tente reinstalar o pacote \verb|freeradius-ldap|. Após
editar o arquivo com suas configurações, faça um link simbólico para a pasta
\verb|mods-enabled|. Somente os módulos que estão nesta pasta são carregados ao
se iniciar o servidor Radius:
\begin{verbatim}
# ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ldap
\end{verbatim}


Edite o arquivo \verb|/etc/raddb/sites-available/default|, na seção authorize,
onde está \verb|-ldap|, retire o -, deixando a entrada assim:
\begin{verbatim}
authorize {
    ...
    #
    #  The ldap module reads passwords from the LDAP database.
    ldap
    ...
}

...

\end{verbatim}

\subsection{LDAP}

Primeiramente, para instalar o OpenLdap, execute:
\begin{verbatim}
# apt update
# apt install slapd ldap-utils
\end{verbatim}

Feito isso, vamos configurar o sldap com os dados do domínio, com o comando:

\begin{verbatim}
# dpkg-reconfigure slapd
\end{verbatim}

Configure de acordo com:
\begin{itemize}
    \item Deseja sair e não reconfigurar o openldap: No
    \item Nome do dominio: example.com
    \item Nome da organização: unb
    \item Senha do dominio: admin
    \item Confirme a senha do dominio: admin
    \item Banco de dados que será usado para armazenar os dados: HDB
    \item Deseja que a base existente seja removida?: No
    \item Deseja mover os arquivos antigos para uma pasta backup?: Yes
    \item Deseja habilitar o protocolo LDAPv2? : No
    \item Pronto! Agora para testar, faça uma pesquisa, como:
\end{itemize}

Se tudo deu certo, basta popularmos nossa base ldap, para isso, crie um arquivo
chamado \verb|group.ldif| e adicione o seguinte conteúdo:
\begin{verbatim}
dn: ou=tech,dc=example,dc=com
ou: Group
objectClass: organizationalUnit
\end{verbatim}

Salve o arquivo e execute o seguinte comando para adicionar estes dados à base do OpenLDAP:
\begin{verbatim}
$ ldapadd -x -W -D "cn=admin,dc=example,dc=com" -f ~/group.ldif
\end{verbatim}

Feito isso, vamos criar alguns usuários. No nosso exemplo criamos um usuário chamado rafael e joao.
Para isso, crie um arquivo chamado user.ldif e adicione o seguinte conteúdo:
\begin{verbatim}
dn: uid=jon,ou=tech,dc=example,dc=com
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: Rafael Fazzolino
uid: rafael
uidNumber: 10000
gidNumber: 10000
homeDirectory: /home/rafael
loginShell: /bin/bash
gecos: rafael,diretor,Aguas claras,435-555-555,801-555-555
userPassword: pass
shadowLastChange: 0
shadowMax: 0
shadowWarning: 0

dn: uid=arya,ou=tech,dc=example,dc=com
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: Joao Paulo
uid: joao
uidNumber: 20000
gidNumber: 20000
homeDirectory: /home/joao
loginShell: /bin/bash
gecos: joao,diretor,Lago sul,435-555-555,801-555-555
userPassword: pass
shadowLastChange: 0
shadowMax: 0
shadowWarning: 0
\end{verbatim}

Agora adicione os dois usuários à base com o comando:
\begin{verbatim}
$ ldapadd -x -W -D "cn=admin,dc=example,dc=com" -f ~/user.ldif
\end{verbatim}

Agora, para verificar se está tudo certo, execute:

\begin{verbatim}
$ ldapsearch -x -b dc=example,dc=com
\end{verbatim}

\subsection{phpldapadmin}

O tutorial para configurar o phpldapadmin pode ser encontrado em \url{https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-openldap-and-phpldapadmin-on-an-ubuntu-14-04-server}


\bibliography{edit/refs}